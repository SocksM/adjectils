<!DOCTYPE html>
  <html>
  <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
  <body onload="updatePage()">
  <title>adjectils - Spider's Den</title>
  <link rel="stylesheet" href="stylesheet.css">
  <meta name = "description" content = "Arachnid utilities for Hypixel Skyblock">
  <meta name = "author" content = "adjective_n0un">
  <span class = header>adjectils: spider's den</span><br>
  <div style = "width: 604px">
  <div style = "float:left; width:200px"><a href = "index.html">Skyblock Hub</a></div><div style = "float:left;width:200px; text-align: center;"><a href = "end.html">The End</a></div><div style = "float:right; width:200px; text-align: right;"><a href = "crimson.html">Crimson Isle</a></div>
  </div><br>
    <div class = "spider_block" style = "width: 600px", id = "box2">
        <span class = spiderheader>Tarantula Broodfather</span><br>
        <span class = basictext>User's Magic Find: </span><input type = "number" inputmode = "numeric" id = slayermagicfind value = 120 min = 0 max = 900 onchange = updateAllChances()></input><br>
        <span class = basictext>RNG meter percent: </span><input type = "number" inputmode = "numeric" id = rngmeterpercent value = 0 min = 0 max = 100 onchange = updateAllChances()></input><span>%</span><br>
        <form action = "#">
            <label>Selected meter item: </label>
            <select id = selecteddrop onchange = updateAllChances()>
                <option value = null>None</option>
                <option value = toxic>Toxic Arrow Poison</option>
                <option value = catalyst_spider>Spider Catalyst</option>
                <option value = book_bane>Bane of Arthropods VI book</option>
                <option value = swatter>Fly Swatter</option>
                <option value = tarantali>Tarantula Talisman</option>
                <option value = mosquito>Digested Mosquito</option>
                <option value = rune_bite>Bite Rune</option>
            </select>
        </form>
        <span class = fineprint>Note: This calculator only provides the chances for tier 4.</span>   
        <table id = loottable_spider>
        <tr><td><hr class = solid></td></tr>
        <tr><td><span class = basictext>Chance of Toxic Arrow Poison: </span></td><td><span style = "text-align: right" class = basictext id = chance_toxic></span></td><br></tr>
        <tr><td><span class = basictext>Chance of Spider Catalyst: </span></td><td><span class = basictext id = chance_catalyst_spider></span><br></td></tr>
        <tr><td><span class = basictext>Chance of Bane of Arthropods VI book: </span></td><td><span class = basictext id = chance_book_bane></span><br></td></tr>
        <tr><td><span class = basictext>Chance of Fly Swatter: </span></td><td><span class = basictext id = chance_swatter></span><br></td></tr>
        <tr><td><span class = basictext>Chance of Tarantula Talisman: </span></td><td><span class = basictext id = chance_tarantali></span><br></td></tr>
        <tr><td><span class = basictext>Chance of Digested Mosquito: </span></td><td><span class = basictext id = chance_mosquito></span><br></td></tr>
        <tr><td><hr class = solid></td></tr>
        <tr><td><span class = fineprint>The following drops may be obtained in addition to the primary drop.</span></td></tr>
        <tr><td><span class = basictext>Chance of Bite Rune I: </span></td><td><span class = basictext id = chance_rune_bite></span><br></td></tr>
        <tr><td><hr class = solid></td></tr>
        </table>
        
      </div>
      </body>  
      <script>
        function updateAllChances(){
            var weights = {
                "toxic": 1800,
                "catalyst_spider": 75,
                "book_bane": 100,
                "swatter": 20,
                "tarantali": 20,
                "mosquito": 7,
            }
            var extraweights = {
                "rune_bite": 833,
            }
            if (slayermagicfind.value > 900){
                mf = 900;
                document.getElementById("slayermagicfind").value = 900;
            }
            if (slayermagicfind.value < 0 || isNaN(slayermagicfind.value) || slayermagicfind.value == ""){
                mf = 0;
                document.getElementById("slayermagicfind").value = 0;
            }
            if (rngmeterpercent.value > 100) {
                document.getElementById("rngmeterpercent").value = 100;
                rmc = 3;
            } 
            else if (rngmeterpercent.value < 0 || isNaN(rngmeterpercent.value)){
                document.getElementById("rngmeterpercent").value = 0;
                rmc = 1;
            } else {
                rmc = (rngmeterpercent.value / 50) + 1;
            }
            var mfc = 1 + (slayermagicfind.value/100);
            console.log("Calcing chances for " + mfc + " coefficient");
            var standardweight = 10000;
            //Calculate total standard weight
            for (var key in weights){
                if (key != selecteddrop.value){
                standardweight += weights[key];
                document.getElementById("chance_" + key).className = "basictext";
                } else {
                weights[key] = weights[key] * rmc;
                standardweight += weights[key];
                document.getElementById("chance_" + key).className = "metereditem";
                }
            }
            console.log("Standard weight: " + standardweight);
            var mfweight = standardweight;
            //Update weights for standard items
            for (var key in weights){
                if (weights[key] / standardweight < 0.05){
                mfweight += (weights[key] * mfc) - weights[key];
                weights[key] = weights[key] * mfc;
                } 
            }
            console.log("Modded weight: " + mfweight);
            //Update chances for standard items
            for (var key in weights){
                var chance = (weights[key] / mfweight) * 100;
                document.getElementById("chance_" + key).innerText = chance.toFixed(3) + "%";
            }
            //Update standard weight with extra weights
            for (var key in extraweights){
                if (key != selecteddrop.value){
                    standardweight += extraweights[key];
                    mfweight += extraweights[key];
                    document.getElementById("chance_" + key).className = "basictext";
                } else {
                    extraweights[key] = extraweights[key] * rmc;
                    standardweight += extraweights[key];
                    mfweight += extraweights[key];
                    document.getElementById("chance_" + key).className = "metereditem";
                }
            }
            var mfextraweight = standardweight;
            //Update weights for extra items
            for (var key in extraweights){
                if ( (extraweights[key] / standardweight) < 0.05){
                    mfextraweight += (extraweights[key] * mfc) - extraweights[key];
                    extraweights[key] = extraweights[key] * mfc;
                } 
            }
            //Update chances for extra items
            for (var key in extraweights){
                var chance = (extraweights[key] / mfextraweight) * 100;
                document.getElementById("chance_" + key).innerText = chance.toFixed(3) + "%";
            }
        }
        function updatePage(){
            console.log("Initializing...");
            updateAllChances();
        }
      </script>